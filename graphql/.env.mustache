#!/bin/bash
# Simplify Deployment Environment
# Project: {{ProjectNamePascal}}
# Deployment: {{ProjectName}}
# Region: {{DeploymentRegion}}
# Profile: {{DeploymentProfile}}
# Version: {{ProjectVersion}}

### Authorizer Setup (Cognito Authorizer)
# - OAUTH_CLIENT_ID is Cognito Web ClientID
# - OAUTH_APP_ID is Cognito Identity Pool Id
OAUTH_CLIENT_ID=
OAUTH_APP_ID=
USER_POOL_ID=

### Deployment Setup
AWS_SDK_LOAD_CONFIG=true
STACK_ON_FAILURE=DELETE
#STACK_ON_FAILURE=ROLLBACK
#STACK_ON_FAILURE=DO_NOTHING
DEPLOYMENT_ENV={{DeploymentEnvSnake}}
PROJECT_ID={{ProjectId}}
### Gateway and Servers Setup
GATEWAY_API_KEY={{DeploymentApiKey}}
{{#Servers}}
ENV_{{Name}}_DEPLOYMENT_STAGE=latest
ENV_{{Name}}_ENFORCEMENT_PACKAGE=
ENV_{{Name}}_DEPLOYMENT_LAYER={{NameSnake}}
{{/Servers}}
{{#Functions}}
ENV_Executions_{{FunctionName}}_DEPLOYMENT_STAGE=latest
ENV_Executions_{{FunctionName}}_ENFORCEMENT_PACKAGE={{ProjectName}}{{DeploymentEnvPascal}}-{{Name}}-v1.0
ENV_Executions_{{FunctionName}}_DEPLOYMENT_LAYER={{FunctionNameSnake}}
{{/Functions}}
### TODO-1: Tag a service as `stable` then `npm run push-code`
# - ENV_yourServiceName_DEPLOYMENT_STAGE=stable
### TODO-2: Versioning a code as an enforcement package then `npm run push-code`
# - ENV_yourServiceName_DEPLOYMENT_STAGE=enforce
# - ENV_yourServiceName_ENFORCEMENT_PACKAGE=ProjectName-FunctionName-version
### TODO-3: Switch bluegree/canary deployment by `npm run push-config`
# - ENV_yourServiceName_DEPLOYMENT_STAGE=canary
# - ENV_yourServiceName_DEPLOYMENT_STAGE=stable
# - ENV_yourServiceName_DEPLOYMENT_STAGE=latest
# - ENV_yourServiceName_DEPLOYMENT_STAGE=enforce